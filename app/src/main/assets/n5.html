<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>動詞活用クイズ (N5)</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #fef2f2 0%, #fce7f3 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
    }
    
    .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
    }
    
    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        z-index: 10;
    }
    
    .back-btn {
        padding: 0.5rem;
        border-radius: 50%;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }
    
    .back-btn:hover {
        background-color: #f1f5f9;
    }
    
    .back-btn svg {
        width: 20px;
        height: 20px;
        color: #475569;
    }
    
    .header-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: bold;
        color: #1e293b;
        font-size: 0.875rem;
        flex: 1;
        justify-content: center;
        margin: 0 0.5rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .header-title svg {
        width: 16px;
        height: 16px;
        color: #ec4899;
        flex-shrink: 0;
    }
    
    .combo-badge {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        background: #fef3c7;
        padding: 0.375rem 0.75rem;
        border-radius: 9999px;
        color: #d97706;
        font-weight: bold;
        font-size: 0.75rem;
        border: 1px solid #fde68a;
        flex-shrink: 0;
    }
    
    .combo-badge svg {
        width: 14px;
        height: 14px;
    }
    
    /* Tabs */
    .tabs-container {
        display: flex;
        overflow-x: auto;
        padding: 1rem;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid white;
        scrollbar-width: none;
    }
    
    .tabs-container::-webkit-scrollbar {
        display: none;
    }
    
    .tab {
        white-space: nowrap;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: bold;
        border: 1px solid;
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
    }
    
    .tab.active {
        background: #ec4899;
        color: white;
        border-color: #ec4899;
        box-shadow: 0 2px 4px rgba(236, 72, 153, 0.3);
    }
    
    .tab:not(.active) {
        background: white;
        color: #64748b;
        border-color: #f1f5f9;
    }
    
    .tab:not(.active):hover {
        background: #f8fafc;
    }
    
    /* Main Content */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
    }
    
    .bg-decoration {
        position: absolute;
        top: 2.5rem;
        left: 2.5rem;
        opacity: 0.1;
        pointer-events: none;
        width: 120px;
        height: 120px;
        color: #ec4899;
    }
    
    .question-card {
        width: 100%;
        max-width: 28rem;
        background: white;
        border-radius: 2.5rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        border: 4px solid #fce7f3;
        text-align: center;
        position: relative;
        z-index: 0;
    }
    
    .question-label {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        background: #f1f5f9;
        color: #64748b;
        font-size: 0.75rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
    }
    
    .question-text {
        font-size: 2.25rem;
        font-weight: bold;
        color: #1e293b;
        margin-bottom: 0.5rem;
        min-height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        word-break: break-word;
        width: 100%;
    }
    
    .hint-text {
        font-size: 0.875rem;
        color: #94a3b8;
        font-weight: bold;
        margin-bottom: 1rem;
    }
    
    .input-container {
        margin-top: 2rem;
        position: relative;
        transition: transform 0.3s;
    }
    
    .input-container.shake {
        animation: shake 0.3s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .answer-input {
        width: 100%;
        height: 4rem;
        text-align: center;
        font-size: 1.25rem;
        font-weight: bold;
        border-radius: 1rem;
        border: 2px solid;
        padding: 0 3rem 0 1rem;
        transition: all 0.2s;
        outline: none;
    }
    
    .answer-input:focus {
        outline: none;
    }
    
    .answer-input.none {
        border-color: #e2e8f0;
        background: #f8fafc;
    }
    
    .answer-input.none:focus {
        border-color: #ec4899;
    }
    
    .answer-input.correct {
        border-color: #4ade80;
        background: #f0fdf4;
        color: #166534;
    }
    
    .answer-input.incorrect {
        border-color: #f87171;
        background: #fef2f2;
        color: #991b1b;
    }
    
    .feedback-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 24px;
    }
    
    .feedback-icon.correct {
        color: #22c55e;
        animation: bounce 0.5s;
    }
    
    .feedback-icon.incorrect {
        color: #ef4444;
        animation: pulse 1s;
    }
    
    @keyframes bounce {
        0%, 100% { transform: translateY(-50%) scale(1); }
        50% { transform: translateY(-50%) scale(1.2); }
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .correction-box {
        margin-top: 1rem;
        padding: 0.75rem;
        background: #fee2e2;
        border-radius: 0.75rem;
        animation: slideIn 0.3s;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .correction-label {
        font-size: 0.75rem;
        color: #dc2626;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    .correction-answer {
        font-size: 1.125rem;
        color: #991b1b;
        font-weight: bold;
        margin-top: 0.25rem;
    }
    
    .action-button {
        margin-top: 2rem;
        width: 100%;
        padding: 1rem;
        border-radius: 0.75rem;
        font-weight: bold;
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 1rem;
    }
    
    .action-button:active {
        transform: scale(0.95);
    }
    
    .action-button.confirm {
        background: #ec4899;
    }
    
    .action-button.confirm:hover {
        background: #db2777;
    }
    
    .action-button.next {
        background: #475569;
    }
    
    .action-button.next:hover {
        background: #334155;
    }
    
    .action-button svg {
        width: 18px;
        height: 18px;
    }
</style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <button class="back-btn" onclick="window.history.back()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <div class="header-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                    <path d="M2 2l7.586 7.586"></path>
                    <circle cx="11" cy="11" r="2"></circle>
                </svg>
                <span>動詞活用クイズ (N5)</span>
            </div>
            
            <div class="combo-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                    <path d="M4 22h16"></path>
                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                </svg>
                <span>Combo: <span id="combo">0</span></span>
            </div>
        </header>

        <!-- Mode Tabs -->
        <div class="tabs-container">
            <button class="tab active" data-type="meaning_to_dict" onclick="setQuizType('meaning_to_dict')">辞書形</button>
            <button class="tab" data-type="dict_to_masu" onclick="setQuizType('dict_to_masu')">ます形</button>
            <button class="tab" data-type="dict_to_te" onclick="setQuizType('dict_to_te')">て形</button>
            <button class="tab" data-type="dict_to_nai" onclick="setQuizType('dict_to_nai')">ない形</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Background Decoration -->
            <div class="bg-decoration">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
            </div>

            <!-- Question Card -->
            <div class="question-card">
                <span class="question-label" id="questionLabel">中国語の意味 → 辞書形</span>
                
                <h2 class="question-text" id="questionText">題目載入中...</h2>
                
                <p class="hint-text" id="hintText" style="display: none;">Hint: </p>

                <!-- Input Area -->
                <div class="input-container" id="inputContainer">
                    <input
                        type="text"
                        id="answerInput"
                        class="answer-input none"
                        placeholder="答えを入力..."
                        autocomplete="off"
                        autocapitalize="off"
                        onkeydown="handleKeyDown(event)"
                    />
                    <div class="feedback-icon" id="feedbackIcon" style="display: none;"></div>
                </div>

                <!-- Correction Display -->
                <div class="correction-box" id="correctionBox" style="display: none;">
                    <p class="correction-label">正解 (CORRECT ANSWER)</p>
                    <p class="correction-answer" id="correctAnswer"></p>
                </div>

                <!-- Action Button -->
                <button class="action-button confirm" id="actionButton" onclick="handleAction()">
                    確認する
                </button>
    </div>
    </div>
</div>

<script>
// 動詞原形,ます形,て形,ない型,た形,命令形,せる形 / れる形,原形發音,ます形發音,中文,意向形,
let file = `言う,言います,言って,言わない,言った,言いなさい,言わせる,いう,いいます,說（曰）,,
売る,売ります,売って,売らない,売った,売りなさい,売らせる,うる,うります,賣,,
置く,置きます,置いて,置かない,置いた,置きなさい,置かせる,おく,おきます,放置,,
押す,押します,押して,押さない,押した,押しなさい,押させる,おす,おします,推/按/壓,,
買う,買います,買って,買わない,買った,買いなさい,買わせる,かう,かいます,買,,
書く,書きます,書いて,書かない,書いた,書きなさい,書かせる,かく,かきます,寫,,
貸す,貸します,貸して,貸さない,貸した,貸しなさい,貸させる,かす,かします,借(出),,
聞く,聞きます,聞いて,聞かない,聞いた,聞きなさい,聞かせる,きく,ききます,聽/問,,
切る,切ります,切って,切らない,切った,切りなさい,切らせる,きる,きります,切割/中斷,,
消す,消します,消して,消さない,消した,消しなさい,消させる,けす,けします,消除/擦掉,,
知る,知ります,知って,知らない,知った,知りなさい,知らせる,しる,しります,知道,,
吸う,吸います,吸って,吸わない,吸った,吸え,吸わせる,すう,すいます,吸,,
出す,出します,出して,出さない,出した,出せ,出させる,だす,だします,拿出/提出,,-
撮る,撮ります,撮って,撮らない,撮った,撮れ,撮らせる,とる,とります,拍照/攝影,,
取る,取ります,取って,取らない,取った,取れ,取らせる,とる,とります,拿取,,
脱ぐ,脱ぎます,脱いで,脱がない,脱いた,脱げ,脱がせる,ぬぐ,ぬぎます,脫(衣物等),,
飲む,飲みます,飲んで,飲まない,飲んだ,飲め,飲ませる,のむ,のみます,喝,,
穿く,穿きます,穿いで,穿かない,穿った,穿け,穿かせる,はく,はきます,穿(褲子等),,
履く,履きます,履いて,履かない,履いた,履け,履かせる,はく,はきます,穿(鞋子等),,
貼る,貼ります,貼って,貼らない,貼った,貼れ,貼らせる,はる,はります,張貼,,
引く,引きます,引いて,引かない,引いた,引け,引かせる,ひく,ひきます,拉/引誘/抽,,
弾く,弾きます,弾いて,弾かない,弾いた,弾け,弾かせる,ひく,ひきます,彈奏,,
吹く,吹きます,吹いて,吹かない,吹いた,吹け,吹かせる,ふく,ふきます,吹,,
待つ,待ちます,待って,待たない,待った,待て,待たせる,まつ,まちます,等待,,
持つ,持ちます,持って,持たない,持った,持て,持たせる,もつ,もちます,拿/持有,,
呼ぶ,呼びます,呼んで,呼ばない,呼んだ,呼べ,呼ばせる,よぶ,よびます,呼叫/稱呼,,
読む,読みます,読んで,読まない,読んだ,読め,読ませる,よむ,よみます,讀/唸,,
洗う,洗います,洗って,洗わない,洗った,洗え,洗わせる（あらわせる）,あらう,あらいます,洗(手.物品),,
歌う,歌います,歌って,歌わない,歌った,歌え,歌わせる（うたわせる）,うたう,うたいます,唱,,
頼む,頼みます,頼んで,頼まない,頼んだ,頼め,頼ませる（たのませる）,たのむ,たのみます,拜託/請求,,
使う,使います,使って,使わない,使った,使え,使わせる（つかわせる）,つかう,つかいます,使用,,
作る,作ります,作って,作らない,作った,作れ,作らせる（つくらせる）,つくる,つくります,製作/做,,
習う,習います,習って,習わない,習った,習え,習わせる（ならわせる）,ならう,ならいます,學習/用功,,重複練習學習的(比如腳踏車)
話す,話します,話して,話さない,話した,話せ,話させる（はなさせる）,はなす,はなします,說/談/討論,,
磨く,磨きます,磨いて,磨かない,磨いた,磨け,磨かせる（みがかせる）,みがく,みがきます,磨/刷(牙),,
渡す,渡します,渡して,渡さない,渡した,渡せ,渡させる（わたさせる）,わたす,わたします,交給/渡過,,-
返す,返します,返して,返さない,返した,返せ,返させる（かえさせる）,かえす,かえします,退回、歸還,,
やる,やります,やって,やらない,やった,やれ,やらせる,やる,やります,做(某事),,-
さす,さします,さして,ささない,さした,させ,させる,さす,さします,撐(傘),,-
なくす,なくします,なくして,なくさない,なくした,なくせ,なくさせる,なくす,なくします,弄丟/丟失,,
かぶる,かぶります,かぶって,かぶらない,かぶった,かぶれ,かぶらせる,かぶる,かぶります,戴(帽子等),,-
くださる,くださいます,くださって,くださいません,くださった,くださってください,くださらせる,くださる,くださいます,給,,-
着る,着ます,着て,着ない,着た,着ろ,着せる（きせる）,きる,きます,穿(上衣等),,
見る,見ます,見て,見ない,見た,見ろ,見せる（みせる）,みる,みます,看,,
浴びる,浴びます,浴びて,浴びない,浴びた,浴びろ,浴びせる（あびせる）,あびる,あびます,淋浴/蒙受,,
借りる,借ります,借りて,借りない,借りた,借りろ,借りせる（かりせる）,かりる,かります,借(入),,
開ける,開けます,開けて,開けない,開けた,開けろ,開けせる（あけせる）,あける,あけます,打開(他動詞),,
入れる,入れます,入れて,入れない,入れた,入れろ,入れせる（いれせる）,いれる,いれます,放入,,
締める,締めます,締めて,締めない,締めた,締めろ,締めせる（しめせる）,しめる,しめます,繫上/減縮,,
閉める,閉めます,閉めて,閉めない,閉めた,閉めろ,閉めせる（しめせる）,しめる,しめます,關閉,,
食べる,食べます,食べて,食べない,食べた,食べろ,食べさせる（たべさせる）,たべる,たべます,吃,,
見せる,見せます,見せて,見せない,見せた,見せろ,見せる（みせる）,みせる,みせます,讓看/展現,,
教える,教えます,教えて,教えない,教えた,教えろ,教えさせる（おしえさせる）,おしえる,おしえます,教導/告訴,,
勤める,勤めます,勤めて,勤めない,勤めた,勤めろ,勤めさせる（つとめさせる）,つとめる,つとめます,任職/工作,,
並べる,並べます,並べて,並べない,並べた,並べろ,並べさせる（ならべさせる）,ならべる,ならべます,並列/排列,,
かける,かけます,かけて,かけない,かけた,かけろ,かけさせる,-,かけます,戴上/花費/撥打(電話),,
あげる,あげます,あげて,あげない,あげた,あげろ,あげさせる,-,あげます,抬/舉/舉行,,
つける,つけます,つけて,つけない,つけた,つけろ,つけさせる,-,つけます,安裝/佩帶/附加/開(燈),,
なる,なります,なって,ならない,なった,なれ,ならせる,-,なります,成為/組成,,
会う,会います,会って,会わない,会った,会え,会わせる（あわせる）,あう,あいます,遇見/見面,,
開く,開きます,開いて,開かない,開けた,開け,開かせる（あかせる）,ひらく,ひらきます,開(自動詞),,
ある,あります,あって,ない,あった,あれ,させる,ある,あります,有,,
行く,行きます,行って,行かない,行った,行け,行かせる（いかせる）,いく,いきます,去/往,,
要る,要ります,要って,要らない,要った,要れ,要らせる,いる,いります,要/需要,,
咲く,咲きます,咲いて,咲かない,咲いた,咲け,咲かせる（さかせる）,さく,さきます,開(花),,
死ぬ,死にます,死んで,死なない,死んだ,死ね,死なせる（しなせる）,しぬ,しにます,死,,
住む,住みます,住んで,住まない,住んだ,住め,住ませる（すませる）,すむ,すみます,居住,,
立つ,立ちます,立って,立たない,立った,立て,立たせる（たたせる）,たつ,たちます,站/立,,
着く,着きます,着いて,着かない,着いた,着け,着かせる（きかせる）,つく,つきます,到達/碰觸/就坐,,
飛ぶ,飛びます,飛んで,飛ばない,飛んだ,飛べ,飛ばせる（とばせる）,とぶ,とびます,飛/跳,,
泣く,泣きます,泣いて,泣かない,泣いた,泣け,泣かせる（なかせる）,なく,なきます,哭泣,,
鳴く,鳴きます,鳴いて,鳴かない,鳴いた,鳴け,鳴かせる（なかせる）,なく,なきます,動物鳴叫,,
乗る,乗ります,乗って,乗らない,乗った,乗れ,乗らせる（のらせる）,のる,のります,乘坐/搭乘,,
吹く,吹きます,吹いて,吹かない,吹いた,吹け,吹かせる（ふかせる）,ふく,ふきます,吹,,
降る,降ります,降って,降りない,降りた,降れ,降らせる（ふらせる）,ふる,ふります,下(雨)/降下,,
泳ぐ,泳ぎます,泳いで,泳がない,泳いだ,泳げ,泳がせる（およがせる）,およぐ,およぎます,游泳,,
帰る,帰ります,帰って,帰らない,帰った,帰れ,帰らせる（かえらせる）,かえる,かえります,回去/回家,,
曇る,曇ります,曇って,曇らない,曇った,曇れ,曇らせる（くもらせる）,くもる,くもります,陰天,,
困る,困ります,困って,困らない,困った,困れ,困らせる（こまらせる）,こまる,こまります,困擾/為難,,
座る,座ります,座って,座らない,座った,座れ,座らせる（すわらせる）,すわる,すわります,坐下,,
違う,違います,違って,違わない,違った,違え,違わせる（ちがわせる）,ちがう,ちがいます,不同/錯誤,,
並ぶ,並びます,並んで,並ばない,並んだ,並べ,並べさせる（ならべさせる）,ならぶ,ならびます,排列,,
登る,登ります,登って,登らない,登った,登れ,登らせる（のぼらせる）,のぼる,のぼります,登(山)/上升,,
入る,入ります,入って,入らない,入った,入れ,入らせる（いれらせる）,はいる,はいります,進入/裝有,,
走る,走ります,走って,走らない,走った,走れ,走らせる（はしらせる）,はしる,はしります,跑/行駛(車),,
渡る,渡ります,渡って,渡らない,渡った,渡れ,渡らせる（わたらせる）,わたる,わたります,渡過/經過,,
遊ぶ,遊びます,遊んで,遊ばない,遊んだ,遊べ,遊ばせる（あそばせる）,あそぶ,あそびます,玩耍,,
歩く,歩きます,歩いて,歩かない,歩いた,歩け,歩かせる（あるかせる）,あるく,あるきます,走/步行,,
終わる,終わります,終わって,終わらない,終わった,終われ,終わらせる（おわらせる）,おわる,おわります,結束,,
掛かる,掛かります,掛かって,掛からない,掛かった,掛かれ,掛からせる（かからせる）,かかる,かかります,掛著/花費,,
閉まる,閉まります,閉まって,閉まらない,閉まった,閉まれ,閉まらせる（しまらせる）,しまる,しまります,關閉,,
止まる,止まります,止まって,止まらない,止まった,止まれ,止まらせる（とまらせる）,とまる,とまります,停住/停止,,
始まる,始まります,始まって,始まらない,始まった,始まれ,始まらせる（はじまらせる）,はじまる,はじまります,開始(自動詞),,
曲がる,曲がります,曲がって,曲がらない,曲がった,曲がれ,曲がらせる（まがらせる）,まがる,まがります,轉彎/傾斜,,
分かる,分かります,分かって,分からない,分かった,分かれ,分からせる（わからせる）,わかる,わかります,理解/明白,,
居る,居ります,居って,居ない,居た,居れ,居らせる（いらせる）,いる,おります,(居)在,,
起きる,起きます,起きて,起きない,起きた,起きろ,起きさせる（おきさせる）,おきる,おきます,起來/發生,,
降りる,降ります,降りて,降らない,降りた,降りろ,降らせる（ふらせる）,おりる,おります,下(車.樓梯),,
出来る,出来ます,出来て,出来ない,出来た,出来ろ,出来させる（できさせる）,できる,できます,能/可以,,
出る,出ます,出て,出ない,出た,出ろ,出させる（ださせる）,でる,でます,出來/離開,,
寝る,寝ます,寝て,寝ない,寝た,寝ろ,寝させる（ねさせる）,ねる,ねます,睡覺(自動詞),,
覚える,覚えます,覚えて,覚えない,覚えた,覚えろ,覚えさせる（おぼえさせる）,おぼえる,おぼえます,記住/學會,,
消える,消えます,消えて,消えない,消えた,消えろ,消えさせる（きえさせる）,きえる,きえます,消失,,
答える,答えます,答えて,答えない,答えた,答えろ,答えさせる（こたえさせる）,こたえる,こたえます,回答,,
疲れる,疲れます,疲れて,疲れない,疲れた,疲れろ,疲れさせる（つかれさせる）,つかれる,つかれます,疲累,,
晴れる,晴れます,晴れて,晴れない,晴れた,晴れろ,晴れさせる（はれさせる）,はれる,はれます,放晴,,
生まれる,生まれます,生まれて,生まれない,生まれた,生まれろ,生まれさせる（うまれさせる）,うまれる,うまれます,出生/產生,,
出掛ける,出掛けます,出掛けて,出掛けない,出掛けた,出掛けろ,出掛けさせる（でかけさせる）,でかける,でかけます,出門、外出,,
コピーする,コピーします,コピーして,コピーしない,コピーした,コピーしてください,コピーさせる,-,こぴーします,拷貝/影印,,
質問する,質問します,質問して,質問しない,質問した,質問してください,質問させる（しつもんさせる）,しつもんする,しつもんします,提問,,
洗濯する,洗濯します,洗濯して,洗濯しない,洗濯した,洗濯してください,洗濯させる（せんたくさせる）,せんたくする,せんたくします,洗(衣物),,
掃除する,掃除します,掃除して,掃除しない,掃除した,掃除してください,掃除させる（そうじさせる）,そうじする,そうじします,打掃,,
勉強する,勉強します,勉強して,勉強しない,勉強した,勉強してください,勉強させる（べんきょうさせる）,べんきょうする,べんきょうします,學習/用功,,
練習する,練習します,練習して,練習しない,練習した,練習してください,練習させる（れんしゅうさせる）,れんしゅうする,れんしゅうします,練習,,
結婚する,結婚します,結婚して,結婚しない,結婚した,結婚してください,結婚させる（けっこんさせる）,けっこんする,けっこんします,結婚,,
散歩する,散歩します,散歩して,散歩しない,散歩した,散歩してください,散歩させる（さんぽさせる）,さんぽする,さんぽします,散步,,
旅行する,旅行します,旅行して,旅行しない,旅行した,旅行してください,旅行させる（りょこうさせる）,りょこうする,りょこうします,旅行,,
来る,来ます,来て,来ない（こない）,来た,来い（こい）,来れる（これる）,くる,きます,來,,
する,します,して,しない,した,しろ,される,する,します,做(泛用動詞),,`;

let words = [];
let currentVerb = null;
let quizType = 'meaning_to_dict';
let combo = 0;
let feedback = 'none'; // 'none', 'correct', 'incorrect'

window.onload = function() {
    parseCSV();
    nextQuestion();
};

function parseCSV() {
    const lines = file.split('\n');
    lines.forEach(line => {
        const parts = line.split(',');
        if (parts.length >= 10) {
            const verb = parts[0].trim();
            const masuForm = parts[1].trim();
            const teForm = parts[2].trim();
            const naiForm = parts[3].trim();
            const reading = parts[7] ? parts[7].trim() : verb;
            const chinese = parts[9] ? parts[9].trim() : '';
            
            if (verb && masuForm && naiForm && teForm && chinese && verb !== '動詞原形' && verb !== '動詞' && !verb.includes('五段')) {
                words.push({ verb, masuForm, naiForm, teForm, chinese, reading });
            }
        }
    });
}

function setQuizType(type) {
    quizType = type;
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-type="${type}"]`).classList.add('active');
    nextQuestion();
}

function nextQuestion() {
    if (words.length === 0) return;
    const randomVerb = words[Math.floor(Math.random() * words.length)];
    currentVerb = randomVerb;
    feedback = 'none';
    
    updateUI();
    document.getElementById('answerInput').value = '';
    document.getElementById('answerInput').focus();
}

function updateUI() {
    if (!currentVerb) return;
    
    // Update question label
    const labels = {
        'meaning_to_dict': '中国語の意味 → 辞書形',
        'dict_to_masu': '辞書形 → ます形',
        'dict_to_te': '辞書形 → て形',
        'dict_to_nai': '辞書形 → ない形'
    };
    document.getElementById('questionLabel').textContent = labels[quizType];
    
    // Update question text
    let questionText = '';
    if (quizType === 'meaning_to_dict') {
        questionText = currentVerb.chinese;
        document.getElementById('hintText').style.display = 'block';
        document.getElementById('hintText').textContent = `Hint: ${currentVerb.reading}`;
    } else {
        questionText = `${currentVerb.verb} (${currentVerb.reading})`;
        document.getElementById('hintText').style.display = 'none';
    }
    document.getElementById('questionText').textContent = questionText;
    
    // Update input state
    const input = document.getElementById('answerInput');
    input.className = 'answer-input ' + feedback;
    
    // Update feedback icon
    const icon = document.getElementById('feedbackIcon');
    if (feedback === 'correct') {
        icon.style.display = 'block';
        icon.className = 'feedback-icon correct';
        icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    } else if (feedback === 'incorrect') {
        icon.style.display = 'block';
        icon.className = 'feedback-icon incorrect';
        icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
    } else {
        icon.style.display = 'none';
    }
    
    // Update correction box
    const correctionBox = document.getElementById('correctionBox');
    if (feedback === 'incorrect') {
        correctionBox.style.display = 'block';
        const expectedAnswer = getExpectedAnswer();
        document.getElementById('correctAnswer').textContent = expectedAnswer;
    } else {
        correctionBox.style.display = 'none';
    }
    
    // Update action button
    const actionButton = document.getElementById('actionButton');
    if (feedback === 'incorrect') {
        actionButton.className = 'action-button next';
        actionButton.innerHTML = '次へ <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>';
    } else {
        actionButton.className = 'action-button confirm';
        actionButton.textContent = '確認する';
    }
}

function getExpectedAnswer() {
    if (!currentVerb) return '';
    switch (quizType) {
        case 'meaning_to_dict': return currentVerb.verb;
        case 'dict_to_masu': return currentVerb.masuForm;
        case 'dict_to_te': return currentVerb.teForm;
        case 'dict_to_nai': return currentVerb.naiForm;
    }
    return '';
}

function checkAnswer() {
    if (!currentVerb || feedback === 'incorrect') return;
    
    const userAnswer = document.getElementById('answerInput').value.trim();
    const expectedAnswer = getExpectedAnswer();
    
    if (userAnswer === expectedAnswer) {
        feedback = 'correct';
        combo++;
        document.getElementById('combo').textContent = combo;
        updateUI();
        setTimeout(nextQuestion, 1000);
    } else {
        feedback = 'incorrect';
        combo = 0;
        document.getElementById('combo').textContent = combo;
        document.getElementById('inputContainer').classList.add('shake');
        setTimeout(() => {
            document.getElementById('inputContainer').classList.remove('shake');
        }, 500);
        updateUI();
    }
}

function handleAction() {
    if (feedback === 'incorrect') {
        nextQuestion();
    } else {
        checkAnswer();
    }
}

function handleKeyDown(event) {
    if (event.key === 'Enter') {
        if (feedback === 'incorrect') {
            nextQuestion();
        } else if (feedback === 'none') {
            checkAnswer();
        }
    }
}
</script>
</body>
</html>